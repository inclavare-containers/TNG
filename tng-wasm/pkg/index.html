<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="data:," />
  <title>WASM Example</title>
  <style>
    body {
      background: hsl(0, 0%, 10%);
      color: hsl(0, 0%, 100%);
      font-family: monospace;
      padding: 2em;
    }
  </style>
</head>

<body>
  <h1>WASM Example</h1>
  <script type="module">
    import module_init, { fetch, send_demo_request } from "./tng_wasm.js";

    // Init tng wasm module
    await module_init();

    // await send_demo_request();

    {
      // Test fetch with GET function
      const url = "http://127.0.0.1:30001/foo/bar?baz=qux";
      const method = "GET";
      const headers = {}; // Empty headers for simplicity in test
      const body = "Hello"; // Empty body for GET request
      const asAddr = "http://127.0.0.1:8080/";
      const policyIds = ["default"];

      fetch(url, method, headers, body, asAddr, policyIds)
        .then(response => {
          console.log("Fetch response status:", response.status);
          console.log("Response body:", response.text);
          console.log("Response headers:", response.headers);
          console.log("Response ok:", response.ok);
          console.log("Response attestation_result:", response.attestation_result);
        })
        .catch(error => {
          console.error("Fetch error:", error);
        });
    }


    {
      // Test fetch with POST function
      const url = "http://127.0.0.1:30001/foo/bar";
      const method = "POST";
      const headers = {}; // Empty headers for simplicity in test
      const body = JSON.stringify({ answer: 42 }); // Sample body
      const asAddr = "http://127.0.0.1:8080/";
      const policyIds = ["default"];

      fetch(url, method, headers, body, asAddr, policyIds)
        .then(response => {
          console.log("Fetch response status:", response.status);
          console.log("Response body:", response.text);
          console.log("Response headers:", response.headers);
          console.log("Response ok:", response.ok);
          console.log("Response attestation_result:", response.attestation_result);
        })
        .catch(error => {
          console.error("Fetch error:", error);
        });
    }

  </script>
</body>

</html>